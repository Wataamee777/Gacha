<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>🎲 ガチャ一覧</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>🎰 ガチャ一覧（<%= guildId %>）</h1>

  <% if (gachas && gachas.length > 0) { %>
    <% gachas.forEach(gacha => { %>
      <div class="gacha-card">
        <h2>🎯 <%= gacha.name %></h2>
        <p>反応文言: <%= gacha.plex || '未設定' %></p>
        <p>チャンネル: <%= gacha.channel_id || '未設定' %></p>
        <p>ロール: <%= gacha.role_id || '未設定' %></p>
        <p>削除日数: <%= gacha.delete_after_days || '未設定' %></p>

        <!-- ✏️ ガチャ編集 -->
        <h3>✏️ 編集</h3>
        <form method="POST" action="/gacha/<%= guildId %>/<%= gacha.name %>/edit">
          <input type="text" name="editname" placeholder="新しいガチャ名">
          <input type="text" name="plex" placeholder="反応文言">
          <input type="text" name="channel" placeholder="チャンネルID">
          <input type="text" name="role" placeholder="ロールID">
          <input type="number" name="delete_after_days" placeholder="削除までの日数">
          <button type="submit">更新</button>
        </form>

        <form method="POST" action="/gacha/<%= guildId %>/<%= gacha.name %>/edit">
          <input type="hidden" name="delete_now" value="true">
          <button type="submit" class="danger">🗑️ ガチャ削除</button>
        </form>

        <!-- 🎁 アイテム追加 -->
        <h3>🎁 アイテム追加</h3>
        <form method="POST" action="/gacha/<%= guildId %>/<%= gacha.name %>/additem">
          <input type="text" name="name" placeholder="アイテム名" required>
          <input type="text" name="rarity" placeholder="レアリティ">
          <input type="number" step="0.01" name="probability" placeholder="出現確率(%)">
          <button type="submit">追加</button>
        </form>

        <!-- 📦 登録アイテム -->
        <% if (gacha.items && gacha.items.length > 0) { %>
          <h3>📦 登録アイテム</h3>
          <ul>
            <% gacha.items.forEach(item => { %>
              <li>
                <b><%= item.item_name %></b> 
                (<%= item.rarity || '---' %>) 
                - <%= item.chance %>%
                
                <!-- アイテム編集 -->
                <form method="POST" action="/gacha/<%= guildId %>/<%= gacha.name %>/edititem/<%= item.item_name %>" style="display:inline;">
                  <input type="text" name="new_name" placeholder="新しい名前">
                  <input type="text" name="rarity" placeholder="レアリティ">
                  <input type="number" step="0.01" name="chance" placeholder="確率(%)">
                  <button type="submit">更新</button>
                </form>

                <!-- アイテム削除 -->
                <form method="POST" action="/gacha/<%= guildId %>/<%= gacha.name %>/edititem/<%= item.item_name %>" style="display:inline;">
                  <input type="hidden" name="delete_now" value="true">
                  <button type="submit" class="danger">削除</button>
                </form>
              </li>
            <% }); %>
          </ul>
        <% } else { %>
          <p>登録アイテムはありません。</p>
        <% } %>

      </div>
    <% }); %>
  <% } else { %>
    <p>まだガチャが登録されていません。</p>
  <% } %>

  <hr>
  <h3>➕ 新規ガチャ作成</h3>
  <form method="POST" action="/gacha/<%= guildId %>/create">
    <input type="text" name="name" placeholder="ガチャ名" required>
    <input type="text" name="plex" placeholder="反応文言">
    <input type="text" name="channel" placeholder="チャンネルID">
    <input type="text" name="role" placeholder="ロールID">
    <input type="number" name="delete_after_days" placeholder="削除までの日数">
    <button type="submit">作成</button>
  </form>

</body>
</html>
